<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Personal Website Prototype</title>
    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 + ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Framer Motion (UMD). Some CDNs may attach a different global or fail to load; we add a safe fallback shim in code below. -->
    <script crossorigin src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
    <!-- Babel for in-browser JSX transpile (ok for prototypes / GitHub Pages) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-neutral-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState, useRef } = React;

      // --- Robust Framer Motion load with shim fallback ---
      let motion, AnimatePresence;
      (function ensureFramerMotion() {
        const fm = (typeof window !== 'undefined') ? window.framerMotion : undefined;
        if (fm && fm.motion) {
          ({ motion, AnimatePresence } = fm);
        } else {
          console.warn('[Framer Motion] Not found on window.framerMotion — using a lightweight shim. Animations will be disabled.');
          const stripMotionProps = ({ initial, animate, exit, whileHover, whileTap, transition, variants, layout, layoutId, ...rest }) => rest;
          const shimEl = (Tag) => React.forwardRef((props, ref) => <Tag ref={ref} { ...stripMotionProps(props) } />);
          motion = {
            section: shimEl('section'),
            div: shimEl('div'),
            header: shimEl('header'),
            main: shimEl('main'),
          };
          const AP = ({ children }) => <>{children}</>;
          AnimatePresence = AP;
        }
      })();

      // ===== Helper UI =====
      const Button = ({ className = "", children, ...props }) => (
        <button
          className={`px-3 py-2 rounded-2xl shadow-sm border border-neutral-200 hover:shadow transition ${className}`}
          {...props}
        >
          {children}
        </button>
      );
      const Input = ({ className = "", ...props }) => (
        <input
          className={`w-full px-3 py-2 rounded-xl border border-neutral-300 outline-none focus:ring-2 focus:ring-neutral-400 ${className}`}
          {...props}
        />
      );
      const Textarea = ({ className = "", ...props }) => (
        <textarea
          className={`w-full px-3 py-2 rounded-xl border border-neutral-300 outline-none focus:ring-2 focus:ring-neutral-400 ${className}`}
          {...props}
        />
      );
      const Card = ({ className = "", children }) => (
        <div className={`bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-neutral-200 ${className}`}>{children}</div>
      );
      const CardHeader = ({ title, icon }) => (
        <div className="flex items-center gap-2 p-4 border-b border-neutral-100">
          {icon}
          <h3 className="text-lg font-semibold">{title}</h3>
        </div>
      );
      const CardContent = ({ className = "", children }) => (
        <div className={`p-4 ${className}`}>{children}</div>
      );

      // ===== Minimal icon set (inline SVG React components) =====
      const Svg = (p) => (
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p} />
      );
      const Plus = (props) => (<Svg {...props}><path d="M12 5v14M5 12h14"/></Svg>);
      const Trash2 = (props) => (
        <Svg {...props}>
          <polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
          <path d="M10 11v6M14 11v6"/><path d="M10 4h4a1 1 0 0 1 1 1v1H9V5a1 1 0 0 1 1-1z"/>
        </Svg>
      );
      const Save = (props) => (
        <Svg {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Svg>
      );
      const Upload = (props) => (<Svg {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></Svg>);
      const ImagePlus = (props) => (
        <Svg {...props}><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M21 15l-5-5L5 21"/><path d="M15 8h6M18 5v6"/></Svg>
      );
      const LinkIcon = (props) => (
        <Svg {...props}><path d="M10 13a5 5 0 0 0 7.07 0l2.83-2.83a5 5 0 0 0-7.07-7.07L11 5"/><path d="M14 11a5 5 0 0 0-7.07 0L4.1 13.83a5 5 0 0 0 7.07 7.07L13 19"/></Svg>
      );
      const Download = (props) => (<Svg {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Svg>);
      const FileUp = (props) => (<Svg {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><polyline points="12 12 12 18"/><polyline points="9 15 12 12 15 15"/></Svg>);
      const Undo2 = (props) => (<Svg {...props}><path d="M9 14H5l4 4 4-4H9z" transform="rotate(90 9 14)"/><path d="M3 7a9 9 0 1 1 9 9"/></Svg>);
      const Eye = (props) => (<Svg {...props}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/><circle cx="12" cy="12" r="3"/></Svg>);
      const EyeOff = (props) => (<Svg {...props}><path d="M17.94 17.94A10.94 10.94 0 0 1 12 20C5 20 1 12 1 12a21.8 21.8 0 0 1 5.06-6.94"/><path d="M10.58 10.58A2 2 0 1 0 13.42 13.4"/><line x1="1" y1="1" x2="23" y2="23"/></Svg>);

      // Extra icons used only in the Preview section
      const BookOpenIcon = (props) => (
        <Svg {...props}><path d="M2 4h7a2 2 0 0 1 2 2v14H4a2 2 0 0 1-2-2V4z"/><path d="M22 4h-7a2 2 0 0 0-2 2v14h7a2 2 0 0 0 2-2V4z"/></Svg>
      );
      const ProjectorIcon = (props) => (
        <Svg {...props}><circle cx="12" cy="13" r="3"/><path d="M2 16h20"/><path d="M6 16V6h12v10"/></Svg>
      );
      const GraduationCapIcon = (props) => (
        <Svg {...props}><path d="M22 10L12 4 2 10l10 6 10-6z"/><path d="M6 12v5a2 2 0 0 0 1 1.73L12 21l5-2.27A2 2 0 0 0 18 17v-5"/></Svg>
      );

      // ===== Types / defaults =====
      // Use flexible free-text range fields that work on resumes (e.g., "Sep 2021", "May 2025" or "Present").
      const emptyEducation = () => ({ startMonth: "", endMonth: "", program: "", courses: "" });
      const emptyProject = () => ({ title: "", description: "", link: "" });
      const emptyPublication = () => ({ title: "", venue: "", year: "", link: "" });
      const emptyLink = () => ({ label: "", url: "" });

      const DEFAULT_DATA = {
        name: "Your Name",
        nickname: "Nickname",
        selfIntro: "Write a concise introduction about yourself.",
        profileImage: "",
        backgroundImage: "",
        education: [
          { startMonth: "Sep 2021", endMonth: "May 2025", program: "B.S. in Computer Science", courses: "Algorithms, Systems, Databases" },
        ],
        projects: [
          { title: "Cool Project", description: "Brief description of what you built and why it matters.", link: "https://example.com" },
        ],
        publications: [
          { title: "Paper Title", venue: "Conf/Journal", year: "2025", link: "https://doi.org/xx.xxxx" },
        ],
        links: [
          { label: "GitHub", url: "https://github.com/" },
          { label: "LinkedIn", url: "https://www.linkedin.com/" },
        ],
      };

      const STORAGE_KEY = "personal-website-prototype-v1";

      // ===== View-only mode detection =====
      // Visitors can view-only by default using a URL flag: ?view=1  (or ?mode=view)
      // Creators can force edit mode with: ?edit=1 (or ?mode=edit)
      const url = new URL(window.location.href);
      const VIEW_ONLY = url.searchParams.get('view') === '1' || url.searchParams.get('mode') === 'view';
      const FORCE_EDIT = url.searchParams.get('edit') === '1' || url.searchParams.get('mode') === 'edit';

      function PersonalWebsitePrototype() {
        const [data, setData] = useState(DEFAULT_DATA);
        const [editMode, setEditMode] = useState(!VIEW_ONLY); // default to edit unless view-only link
        const [showDiag, setShowDiag] = useState(false);
        const fileInputProfileRef = useRef(null);
        const fileInputBgRef = useRef(null);

        const isViewOnly = VIEW_ONLY && !FORCE_EDIT;
        const showEditor = !isViewOnly && editMode;

        // Load from localStorage
        useEffect(() => {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) setData(JSON.parse(raw));
          } catch (e) {
            console.warn("Failed to load saved data", e);
          }
        }, []);

        // Save to localStorage on change (still allowed in view-only, but there are no inputs visible)
        useEffect(() => {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          } catch (e) {
            console.warn("Failed to persist data", e);
          }
        }, [data]);

        const bgStyle = useMemo(
          () => ({
            backgroundImage: data.backgroundImage ? `url(${data.backgroundImage})` : "linear-gradient(135deg, #f5f7fa, #c3cfe2)",
            backgroundSize: data.backgroundImage ? "cover" : "auto",
            backgroundPosition: "center",
          }),
          [data.backgroundImage]
        );

        // Image upload helpers
        const handleImageUpload = async (file, key) => {
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => setData(d => ({ ...d, [key]: reader.result }));
          reader.readAsDataURL(file);
        };

        const removeImage = (key) => setData(d => ({ ...d, [key]: "" }));

        // Export / Import
        const exportJson = () => {
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "personal-website-data.json";
          a.click();
          URL.revokeObjectURL(url);
        };

        const handleImport = (e) => {
          const file = e.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const parsed = JSON.parse(reader.result);
              setData(parsed);
            } catch (err) {
              alert("Invalid JSON file.");
            }
          };
          reader.readAsText(file);
          e.target.value = ""; // reset
        };

        const resetToDefault = () => setData(DEFAULT_DATA);

        // Diagnostics (rudimentary runtime tests)
        const diagnostics = useMemo(() => {
          const tests = [];
          tests.push({ name: 'React present', pass: !!(window.React && window.ReactDOM) });
          tests.push({ name: 'Framer Motion loaded', pass: !!(window.framerMotion && window.framerMotion.motion), note: (!!(window.framerMotion && window.framerMotion.motion)) ? 'using CDN' : 'shim active' });
          let lsOK = true;
          try { localStorage.setItem('__test__', '1'); localStorage.removeItem('__test__'); } catch { lsOK = false; }
          tests.push({ name: 'localStorage available', pass: lsOK });
          tests.push({ name: 'Image shims ready', pass: typeof FileReader !== 'undefined' });
          return tests;
        }, [data]);

        // Small components
        const LabeledInput = ({ label, hint, ...props }) => (
          <label className="flex flex-col gap-1">
            <span className="text-sm text-neutral-600">{label}</span>
            <Input {...props} />
          </label>
        );

        const LabeledTextarea = ({ label, ...props }) => (
          <label className="flex flex-col gap-1">
            <span className="text-sm text-neutral-600">{label}</span>
            <Textarea rows={5} {...props} />
          </label>
        );

        // Edit Forms
        const EducationEditor = () => (
          <div className="flex flex-col gap-3">
            {data.education.map((ed, idx) => (
              <Card key={idx}>
                <CardContent className="grid grid-cols-12 gap-3 items-end">
                  <div className="col-span-3"><LabeledInput label="Start Time" placeholder="e.g., Sep 2021" value={ed.startMonth} onChange={e => updateArrayItem("education", idx, { startMonth: e.target.value })} /></div>
                  <div className="col-span-3"><LabeledInput label="End Time" placeholder="e.g., May 2025 or Present" value={ed.endMonth} onChange={e => updateArrayItem("education", idx, { endMonth: e.target.value })} /></div>
                  <div className="col-span-6"><LabeledInput label="Degree / Program" value={ed.program} onChange={e => updateArrayItem("education", idx, { program: e.target.value })} /></div>
                  <div className="col-span-12"><LabeledTextarea label="Courses (comma-separated)" value={ed.courses} onChange={e => updateArrayItem("education", idx, { courses: e.target.value })} /></div>
                  <div className="col-span-12 flex justify-end">
                    <Button className="text-red-600 border-red-200" onClick={() => removeArrayItem("education", idx)}><Trash2 className="inline size-4 mr-1"/>Remove</Button>
                  </div>
                </CardContent>
              </Card>
            ))}
            <Button onClick={() => addArrayItem("education", emptyEducation())}><Plus className="inline size-4 mr-1"/>Add Education</Button>
          </div>
        );

        const ProjectsEditor = () => (
          <div className="flex flex-col gap-3">
            {data.projects.map((p, idx) => (
              <Card key={idx}>
                <CardContent className="grid grid-cols-12 gap-3 items-end">
                  <div className="col-span-5"><LabeledInput label="Title" value={p.title} onChange={e => updateArrayItem("projects", idx, { title: e.target.value })} /></div>
                  <div className="col-span-5"><LabeledInput label="Link (optional)" value={p.link} onChange={e => updateArrayItem("projects", idx, { link: e.target.value })} /></div>
                  <div className="col-span-12"><LabeledTextarea label="Description" value={p.description} onChange={e => updateArrayItem("projects", idx, { description: e.target.value })} /></div>
                  <div className="col-span-12 flex justify-end">
                    <Button className="text-red-600 border-red-200" onClick={() => removeArrayItem("projects", idx)}><Trash2 className="inline size-4 mr-1"/>Remove</Button>
                  </div>
                </CardContent>
              </Card>
            ))}
            <Button onClick={() => addArrayItem("projects", emptyProject())}><Plus className="inline size-4 mr-1"/>Add Project</Button>
          </div>
        );

        const PublicationsEditor = () => (
          <div className="flex flex-col gap-3">
            {data.publications.map((p, idx) => (
              <Card key={idx}>
                <CardContent className="grid grid-cols-12 gap-3 items-end">
                  <div className="col-span-6"><LabeledInput label="Title" value={p.title} onChange={e => updateArrayItem("publications", idx, { title: e.target.value })} /></div>
                  <div className="col-span-3"><LabeledInput label="Venue" value={p.venue} onChange={e => updateArrayItem("publications", idx, { venue: e.target.value })} /></div>
                  <div className="col-span-3"><LabeledInput label="Year" value={p.year} onChange={e => updateArrayItem("publications", idx, { year: e.target.value })} /></div>
                  <div className="col-span-12"><LabeledInput label="Link (optional)" value={p.link} onChange={e => updateArrayItem("publications", idx, { link: e.target.value })} /></div>
                  <div className="col-span-12 flex justify-end">
                    <Button className="text-red-600 border-red-200" onClick={() => removeArrayItem("publications", idx)}><Trash2 className="inline size-4 mr-1"/>Remove</Button>
                  </div>
                </CardContent>
              </Card>
            ))}
            <Button onClick={() => addArrayItem("publications", emptyPublication())}><Plus className="inline size-4 mr-1"/>Add Publication</Button>
          </div>
        );

        const LinksEditor = () => (
          <div className="flex flex-col gap-3">
            {data.links.map((l, idx) => (
              <Card key={idx}>
                <CardContent className="grid grid-cols-12 gap-3 items-end">
                  <div className="col-span-5"><LabeledInput label="Label" value={l.label} onChange={e => updateArrayItem("links", idx, { label: e.target.value })} /></div>
                  <div className="col-span-7"><LabeledInput label="URL" value={l.url} onChange={e => updateArrayItem("links", idx, { url: e.target.value })} /></div>
                  <div className="col-span-12 flex justify-end">
                    <Button className="text-red-600 border-red-200" onClick={() => removeArrayItem("links", idx)}><Trash2 className="inline size-4 mr-1"/>Remove</Button>
                  </div>
                </CardContent>
              </Card>
            ))}
            <Button onClick={() => addArrayItem("links", emptyLink())}><Plus className="inline size-4 mr-1"/>Add Link</Button>
          </div>
        );

        // Array helpers
        const updateArrayItem = (key, idx, partial) => {
          setData(prev => ({
            ...prev,
            [key]: prev[key].map((item, i) => (i === idx ? { ...item, ...partial } : item)),
          }));
        };
        const addArrayItem = (key, value) => setData(prev => ({ ...prev, [key]: [...prev[key], value] }));
        const removeArrayItem = (key, idx) => setData(prev => ({ ...prev, [key]: prev[key].filter((_, i) => i !== idx) }));

        // Utilities
        const formatRange = (start, end) => {
          if (!start && !end) return '';
          if (start && !end) return start;
          if (!start && end) return end;
          return `${start} – ${end}`; // en dash between
        };

        // Render
        return (
          <div className="min-h-screen" style={bgStyle}>
            <div className="min-h-screen bg-white/60">
              <header className="max-w-6xl mx-auto px-6 pt-8 pb-4 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="relative">
                    <div className="w-16 h-16 rounded-2xl overflow-hidden border border-neutral-300 bg-white shadow">
                      {data.profileImage ? (
                        <img src={data.profileImage} alt="profile" className="w-full h-full object-cover" />
                      ) : (
                        <div className="w-full h-full flex items-center justify-center text-neutral-400">No Image</div>
                      )}
                    </div>
                  </div>
                  <div>
                    <h1 className="text-2xl font-bold leading-tight">{data.name}</h1>
                    <div className="text-neutral-600">{data.nickname && `AKA ${data.nickname}`}</div>
                  </div>
                </div>

                <div className="flex gap-2">
                  {!isViewOnly && (
                    <Button onClick={() => setEditMode(m => !m)}>
                      {showEditor ? (<><Eye className="inline size-4 mr-1"/>Preview</>) : (<><EyeOff className="inline size-4 mr-1"/>Edit</>)}
                    </Button>
                  )}
                  {!isViewOnly && <Button onClick={exportJson}><Download className="inline size-4 mr-1"/>Export</Button>}
                  {!isViewOnly && (
                    <label>
                      <input type="file" accept="application/json" className="hidden" onChange={handleImport} />
                      <Button><FileUp className="inline size-4 mr-1"/>Import</Button>
                    </label>
                  )}
                  {!isViewOnly && <Button onClick={resetToDefault} className="text-orange-700 border-orange-200"><Undo2 className="inline size-4 mr-1"/>Reset</Button>}
                  {!isViewOnly && <Button onClick={() => setShowDiag(x => !x)} className="text-sky-700 border-sky-200">Diagnostics</Button>}
                </div>
              </header>

              <main className="max-w-6xl mx-auto px-6 pb-24 grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Left: Editor */}
                <AnimatePresence mode="wait">
                  {showEditor && (
                    <motion.section
                      key="editor"
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: 10 }}
                      className="flex flex-col gap-6"
                    >
                      {/* Basics */}
                      <Card>
                        <CardHeader title="Basics" icon={<Save className="size-4" />} />
                        <CardContent className="grid grid-cols-12 gap-4">
                          <div className="col-span-12 lg:col-span-6">
                            <LabeledInput label="Name" value={data.name} onChange={e => setData(d => ({ ...d, name: e.target.value }))} />
                          </div>
                          <div className="col-span-12 lg:col-span-6">
                            <LabeledInput label="Nickname (optional)" value={data.nickname} onChange={e => setData(d => ({ ...d, nickname: e.target.value }))} />
                          </div>
                          <div className="col-span-12">
                            <LabeledTextarea label="Self‑Introduction" value={data.selfIntro} onChange={e => setData(d => ({ ...d, selfIntro: e.target.value }))} />
                          </div>
                        </CardContent>
                      </Card>

                      {/* Images */}
                      <Card>
                        <CardHeader title="Images" icon={<ImagePlus className="size-4" />} />
                        <CardContent className="grid grid-cols-12 gap-4 items-end">
                          <div className="col-span-12 md:col-span-6">
                            <div className="text-sm text-neutral-700 mb-2">Profile Image</div>
                            <div className="flex items-center gap-2">
                              <input ref={fileInputProfileRef} type="file" accept="image/*" className="hidden" onChange={e => handleImageUpload(e.target.files?.[0], "profileImage")} />
                              <Button onClick={() => fileInputProfileRef.current?.click()}><Upload className="inline size-4 mr-1"/>Upload</Button>
                              <Button className="text-red-600 border-red-200" onClick={() => removeImage("profileImage")}><Trash2 className="inline size-4 mr-1"/>Unload</Button>
                            </div>
                          </div>
                          <div className="col-span-12 md:col-span-6">
                            <div className="text-sm text-neutral-700 mb-2">Background Image</div>
                            <div className="flex items-center gap-2">
                              <input ref={fileInputBgRef} type="file" accept="image/*" className="hidden" onChange={e => handleImageUpload(e.target.files?.[0], "backgroundImage")} />
                              <Button onClick={() => fileInputBgRef.current?.click()}><Upload className="inline size-4 mr-1"/>Upload</Button>
                              <Button className="text-red-600 border-red-200" onClick={() => removeImage("backgroundImage")}><Trash2 className="inline size-4 mr-1"/>Unload</Button>
                            </div>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Education */}
                      <Card>
                        <CardHeader title="Education Experience" icon={<GraduationCapIcon />} />
                        <CardContent>
                          <EducationEditor />
                        </CardContent>
                      </Card>

                      {/* Projects */}
                      <Card>
                        <CardHeader title="Projects" icon={<ProjectorIcon />} />
                        <CardContent>
                          <ProjectsEditor />
                        </CardContent>
                      </Card>

                      {/* Publications */}
                      <Card>
                        <CardHeader title="Publications" icon={<BookOpenIcon />} />
                        <CardContent>
                          <PublicationsEditor />
                        </CardContent>
                      </Card>

                      {/* Links */}
                      <Card>
                        <CardHeader title="Other Pages / Links" icon={<LinkIcon className="size-4" />} />
                        <CardContent>
                          <LinksEditor />
                        </CardContent>
                      </Card>
                    </motion.section>
                  )}
                </AnimatePresence>

                {/* Right: Live Preview + Diagnostics */}
                <section className="flex flex-col gap-6">
                  <ProfilePreview data={data} />

                  {!isViewOnly && showDiag && (
                    <Card>
                      <CardHeader title="Diagnostics" icon={<Eye className="size-4" />} />
                      <CardContent>
                        <ul className="space-y-2">
                          {diagnostics.map((t, i) => (
                            <li key={i} className="flex items-center justify-between p-2 rounded-lg border border-neutral-200">
                              <div>
                                <div className="font-medium">{t.name}</div>
                                {t.note && <div className="text-sm text-neutral-600">{t.note}</div>}
                              </div>
                              <span className={`text-sm font-semibold ${t.pass ? 'text-green-700' : 'text-red-700'}`}>{t.pass ? 'PASS' : 'FAIL'}</span>
                            </li>
                          ))}
                        </ul>
                      </CardContent>
                    </Card>
                  )}
                </section>
              </main>

              <footer className="max-w-6xl mx-auto px-6 pb-8 text-center text-sm text-neutral-600">
                Built with ❤️ — your data auto‑saves to your browser (localStorage). Export JSON to back up.
              </footer>
            </div>
          </div>
        );
      }

      // ===== Preview Components =====
      function ProfilePreview({ data }) {
        const formatRange = (s, e) => {
          if (!s && !e) return '';
          if (s && !e) return s;
          if (!s && e) return e;
          return `${s} – ${e}`;
        };
        return (
          <Card>
            <CardHeader title="Live Preview" icon={<Eye className="size-4" />} />
            <CardContent className="space-y-6">
              <div className="flex items-start gap-4">
                <div className="w-24 h-24 rounded-2xl overflow-hidden border border-neutral-300 bg-white">
                  {data.profileImage ? (
                    <img src={data.profileImage} alt="profile" className="w-full h-full object-cover" />
                  ) : (
                    <div className="w-full h-full flex items-center justify-center text-neutral-400">No Image</div>
                  )}
                </div>
                <div>
                  <h2 className="text-2xl font-bold">{data.name}</h2>
                  {data.nickname && <div className="text-neutral-600">AKA {data.nickname}</div>}
                </div>
              </div>

              <section>
                <Section title="About" />
                <p className="mt-2 whitespace-pre-wrap leading-relaxed">{data.selfIntro}</p>
              </section>

              <section>
                <Section title="Education" />
                <ul className="mt-3 space-y-3">
                  {data.education.map((ed, i) => (
                    <li key={i} className="p-3 rounded-xl border border-neutral-200">
                      <div className="text-sm text-neutral-600">{formatRange(ed.startMonth, ed.endMonth)}</div>
                      <div className="font-medium">{ed.program}</div>
                      {ed.courses && (
                        <div className="text-sm mt-1"><span className="text-neutral-600">Courses:</span> {ed.courses}</div>
                      )}
                    </li>
                  ))}
                </ul>
              </section>

              <section>
                <Section title="Projects" />
                <ul className="mt-3 grid md:grid-cols-2 gap-3">
                  {data.projects.map((p, i) => (
                    <li key={i} className="p-4 rounded-xl border border-neutral-200">
                      <div className="font-semibold">{p.title || "Untitled"}</div>
                      <p className="text-sm mt-1 text-neutral-700 whitespace-pre-wrap">{p.description}</p>
                      {p.link && (
                        <a className="inline-flex items-center gap-1 text-sm mt-2 underline" href={p.link} target="_blank" rel="noreferrer">
                          <LinkIcon className="size-4"/> Visit
                        </a>
                      )}
                    </li>
                  ))}
                </ul>
              </section>

              <section>
                <Section title="Publications" />
                <ul className="mt-3 space-y-3">
                  {data.publications.map((p, i) => (
                    <li key={i} className="p-3 rounded-xl border border-neutral-200">
                      <div className="font-medium">{p.title || "Untitled"}</div>
                      <div className="text-sm text-neutral-700">{[p.venue, p.year].filter(Boolean).join(" · ")}</div>
                      {p.link && (
                        <a className="inline-flex items-center gap-1 text-sm mt-2 underline" href={p.link} target="_blank" rel="noreferrer">
                          <LinkIcon className="size-4"/> DOI / Link
                        </a>
                      )}
                    </li>
                  ))}
                </ul>
              </section>

              <section>
                <Section title="Links" />
                <div className="flex flex-wrap gap-2 mt-2">
                  {data.links.map((l, i) => (
                    <a key={i} className="px-3 py-2 rounded-xl border border-neutral-200 hover:bg-neutral-50 inline-flex items-center gap-2" href={l.url} target="_blank" rel="noreferrer">
                      <LinkIcon className="size-4"/>
                      <span>{l.label || l.url}</span>
                    </a>
                  ))}
                </div>
              </section>
            </CardContent>
          </Card>
        );
      }

      function Section({ title }) {
        return (
          <div className="flex items-center gap-2">
            <div className="w-1.5 h-6 rounded-full bg-neutral-800" />
            <h3 className="text-lg font-semibold">{title}</h3>
          </div>
        );
      }

      // Mount
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<PersonalWebsitePrototype />);
    </script>
  </body>
</html>
